/* Design tokens for the Cmdr desktop app.
 * See /.interface-design/system.md for the design system specification.
 *
 * These variables serve as the single source of truth for all colors, spacing,
 * and typography. They can be used in both scoped CSS and Tailwind classes.
 *
 * Future: Can be modified at runtime for user theme customization. */

:root {
    /* Declare support for both color schemes so WKWebView adapts native
     * elements (scrollbars, form controls) to the current system appearance. */
    color-scheme: light dark;

    /* === Backgrounds === */
    --color-bg-primary: #ffffff;
    --color-bg-secondary: #f5f5f5;
    --color-bg-tertiary: #e8e8e8;
    --color-bg-header: #f0f0f0;

    /* === Borders === */
    --color-border-strong: #bbb;
    --color-border: #ddd;
    --color-border-subtle: #e8e8e8;

    /* === Text === */
    --color-text-primary: #1a1a1a;
    --color-text-secondary: #666666;
    --color-text-tertiary: #888888;

    /* === Interactive States ===
     * These accent colors are CSS fallbacks only. At runtime, the Rust backend
     * reads the macOS system accent color and overrides --color-accent via
     * accent-color.ts → initAccentColor(). See src-tauri/src/accent_color.rs. */
    --color-accent: #d4a006;
    --color-accent-hover: color-mix(in oklch, var(--color-accent), white 15%);
    --color-accent-subtle: color-mix(in oklch, var(--color-accent), transparent 85%);
    --color-cmdr-gold: #d4a006;
    --color-system-accent: #d4a006; /* Updated at runtime by accent-color.ts */

    /* === Cursor (row highlight in file lists) === */
    --color-cursor-inactive: color-mix(in srgb, var(--color-bg-tertiary), transparent 60%);
    --color-cursor-active: color-mix(in oklch, var(--color-accent), transparent 80%);

    /* === Semantic Colors === */
    --color-allow: #2e7d32;
    --color-error: #d32f2f;
    --color-error-bg: #fef2f2;
    --color-error-border: #fecaca;
    --color-warning: #e65100;
    --color-warning-bg: rgba(230, 81, 0, 0.1);

    /* === Toast tints (tuned per scheme so warn reads amber, error reads red) === */
    --color-toast-warn-stripe: #d4a006;
    --color-toast-warn-bg: #fef9ee;
    --color-toast-error-bg: #fef2f2;

    /* === Selection === */
    --color-selection-fg: #c9a227;

    /* === Search Highlight === */
    --color-highlight: rgba(255, 213, 0, 0.4);
    --color-highlight-active: rgba(255, 150, 50, 0.6);

    /* === Size tier colors (depth progression: bigger = deeper blue) === */
    --color-size-bytes: color-mix(in srgb, var(--color-text-secondary) 85%, #88aacc);
    --color-size-kb: color-mix(in srgb, var(--color-text-secondary) 60%, #88aacc);
    --color-size-mb: color-mix(in srgb, var(--color-text-secondary) 60%, #5599dd);
    --color-size-gb: color-mix(in srgb, var(--color-text-secondary) 60%, #2288ee);
    --color-size-tb: color-mix(in srgb, var(--color-text-secondary) 60%, #0066ff);

    /* === Size tier colors — selected state (gold depth progression) === */
    --color-size-bytes-selected: color-mix(in srgb, var(--color-text-secondary) 40%, var(--color-selection-fg));
    --color-size-kb-selected: color-mix(in srgb, var(--color-text-secondary) 25%, var(--color-selection-fg));
    --color-size-mb-selected: color-mix(in srgb, var(--color-text-secondary) 15%, var(--color-selection-fg));
    --color-size-gb-selected: color-mix(in srgb, var(--color-text-secondary) 5%, var(--color-selection-fg));
    --color-size-tb-selected: var(--color-selection-fg);

    /* === Spacing === */
    --spacing-xxs: 2px;
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 12px;
    --spacing-lg: 16px;
    --spacing-xl: 24px;
    --spacing-2xl: 32px;

    /* === Sizing === */
    --spacing-tab-bar-height: 28px;

    /* === Typography === */
    --font-system: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    --font-mono: ui-monospace, 'SF Mono', SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    --font-size-xs: 10px;
    --font-size-sm: 12px;
    --font-size-md: 14px;
    --font-size-lg: 16px;
    --font-size-xl: 20px;

    /* === Border radius === */
    --radius-sm: 4px;
    --radius-md: 6px;
    --radius-lg: 8px;
    --radius-full: 9999px;

    /* === Shadows (light) === */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.15);
    --shadow-focus: 0 0 0 3px var(--color-accent-subtle);

    /* === Transitions === */
    --transition-fast: 100ms ease;
    --transition-base: 150ms ease;
    --transition-slow: 200ms ease;

    /* === Z-index scale === */
    --z-base: 0;
    --z-sticky: 10;
    --z-dropdown: 100;
    --z-overlay: 200;
    --z-modal: 300;
    --z-notification: 400;
}

/* Dark Mode - automatically applied when user's system prefers dark mode */
@media (prefers-color-scheme: dark) {
    :root {
        /* === Backgrounds === */
        --color-bg-primary: #1e1e1e;
        --color-bg-secondary: #2a2a2a;
        --color-bg-tertiary: #333333;
        --color-bg-header: #252525;

        /* === Borders === */
        --color-border-strong: #555555;
        --color-border: #444444;
        --color-border-subtle: #333333;

        /* === Text === */
        --color-text-primary: #e8e8e8;
        --color-text-secondary: #aaaaaa;
        --color-text-tertiary: #888888;

        /* === Interactive States (fallbacks — see light-mode comment above) === */
        --color-accent: #ffc206;
        --color-accent-hover: color-mix(in oklch, var(--color-accent), white 10%);
        --color-accent-subtle: color-mix(in oklch, var(--color-accent), transparent 85%);
        --color-cmdr-gold: #ffc206;
        --color-system-accent: #ffc206; /* Updated at runtime by accent-color.ts */

        /* === Cursor (row highlight in file lists) === */
        --color-cursor-inactive: color-mix(in srgb, var(--color-bg-tertiary), transparent 60%);
        --color-cursor-active: color-mix(in oklch, var(--color-accent), transparent 80%);

        /* === Semantic Colors === */
        --color-allow: #66bb6a;
        --color-error: #f44336;
        --color-error-bg: #450a0a;
        --color-error-border: #7f1d1d;
        --color-warning: #f5a623;
        --color-warning-bg: rgba(245, 166, 35, 0.15);

        /* === Toast tints === */
        --color-toast-warn-stripe: var(--color-warning);
        --color-toast-warn-bg: color-mix(in srgb, var(--color-warning) 8%, var(--color-bg-secondary));
        --color-toast-error-bg: color-mix(in srgb, var(--color-error) 8%, var(--color-bg-secondary));

        /* === Selection === */
        --color-selection-fg: #d4a82a;

        /* === Search Highlight === */
        --color-highlight: rgba(255, 213, 100, 0.9);
        --color-highlight-active: rgba(255, 150, 100, 0.9);

        /* === Shadows (dark) === */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.35);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
    }
}

/* =============================================================================
   Reset from https://github.com/filipelinhares/ress/blob/master/dist/ress.min.css with some stripping
   ============================================================================= */

@layer ress-reset {
    html {
        -webkit-text-size-adjust: 100%;
        box-sizing: border-box;
        tab-size: 4;
        word-break: normal;
    }

    *,
    :after,
    :before {
        background-repeat: no-repeat;
        box-sizing: inherit;
    }

    :after,
    :before {
        text-decoration: inherit;
        vertical-align: inherit;
    }

    * {
        margin: 0;
        padding: 0;
    }

    hr {
        color: inherit;
        height: 0;
        overflow: visible;
    }

    details,
    main {
        display: block;
    }

    summary {
        display: list-item;
    }

    abbr[title] {
        border-bottom: none;
        text-decoration: underline dotted;
    }

    a {
        background-color: transparent;
    }

    a:active,
    a:hover {
        outline-width: 0;
    }

    code,
    kbd,
    pre,
    samp {
        font-family: monospace, monospace;
    }

    pre {
        font-size: 1em;
    }

    b,
    strong {
        font-weight: bolder;
    }

    sub,
    sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }

    sub {
        bottom: -0.25em;
    }

    sup {
        top: -0.5em;
    }

    table {
        border-color: inherit;
        text-indent: 0;
    }

    iframe {
        border-style: none;
    }

    input {
        border-radius: 0;
    }

    textarea {
        overflow: auto;
        resize: vertical;
    }

    button,
    input,
    optgroup,
    select,
    textarea {
        font: inherit;
    }

    optgroup {
        font-weight: 700;
    }

    button {
        overflow: visible;
    }

    button,
    select {
        text-transform: none;
    }

    [role='button'],
    [type='button'],
    [type='reset'],
    [type='submit'],
    button {
        cursor: pointer;
    }

    [type='reset'],
    [type='submit'],
    button,
    html [type='button'] {
        appearance: button;
    }

    button,
    input,
    select,
    textarea {
        background-color: transparent;
        border-style: none;
    }

    a:focus,
    button:focus,
    input:focus,
    select:focus,
    textarea:focus {
        outline-width: 0;
    }

    progress {
        vertical-align: baseline;
    }
}

/* =============================================================================
   Global Focus Styles
   ============================================================================= */

/* Consistent focus-visible outline for all interactive elements */
button:focus-visible,
a:focus-visible,
[role='button']:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
}

/* =============================================================================
   Global Styles
   ============================================================================= */

@layer typography {
    ul,
    ol,
    dl {
        list-style-position: inside;
        padding-inline-start: 1lh;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        text-wrap: balance;
    }

    p {
        text-wrap: pretty;
        margin-block-start: 16px;
        margin-block-end: 16px;
    }
}

@media (prefers-reduced-motion: no-preference) {
    html {
        interpolate-size: allow-keywords;
    }
}

/* Fixed font-size for native-app-like behavior:
 * - Establishes 1rem = 16px (makes rem and px interchangeable)
 * - Only responds to OS display scaling (System Settings → Displays)
 * - Ignores WebKit's font-size preferences (unlike percentage-based font-size)
 * This is intentional: we want macOS-native behavior, not web-browser behavior.
 */
html {
    font-size: 16px;
}

html,
body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: var(--color-bg-primary);
    color: var(--color-text-primary);
    /* Disable text selection globally */
    user-select: none;
    -webkit-user-select: none;
    /* Force default cursor everywhere */
    cursor: default;
}

body {
    display: flex;
    flex-direction: column;
}

/* SvelteKit's production build strips inline styles from its mount target.
 * Without this, the #app-root div defaults to display:block, breaking
 * the body flex layout (content overflows instead of fitting the window). */
#app-root {
    display: contents;
}

/* Disable scroll bounce on all scrollable elements */
* {
    overscroll-behavior: none;
}

/* =============================================================================
   Size tier color utility classes (used dynamically via class bindings)
   ============================================================================= */

.size-bytes {
    color: var(--color-size-bytes);
}

.size-kb {
    color: var(--color-size-kb);
}

.size-mb {
    color: var(--color-size-mb);
}

.size-gb {
    color: var(--color-size-gb);
}

.size-tb {
    color: var(--color-size-tb);
}

/* =============================================================================
   Spinner utility classes
   ============================================================================= */

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.spinner {
    display: inline-block;
    flex-shrink: 0;
    border-radius: 50%;
    border-style: solid;
    border-color: var(--color-border);
    border-top-color: var(--color-accent);
    animation: spin 0.8s linear infinite;
}

.spinner-xs {
    width: 8px;
    height: 8px;
    border-width: 1.5px;
}

.spinner-sm {
    width: 12px;
    height: 12px;
    border-width: 2px;
}

.spinner-md {
    width: 24px;
    height: 24px;
    border-width: 2.5px;
}

.spinner-lg {
    width: 32px;
    height: 32px;
    border-width: 2.5px;
}
